import { useEffect, useState } from 'react';
import axios from 'axios';
import { useRemoveWidget } from '../../RemoveWidgetContext';
import '../../RemoveWidgetContext.css';
import './WeatherWidget.css';
// import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';
// import { faTimes } from '@fortawesome/free-solid-svg-icons';
import CloseIcon from '@mui/icons-material/Close';

export default function WeatherWidget() {
  const [weather, setWeather] = useState(null);
  const removeWidget = useRemoveWidget();

  // Calgary, Alberta, Canada coordinates
  const latitude = 51.0447;
  const longitude = -114.0719;

  useEffect(() => {
    axios.get(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true`)
      .then(res => setWeather(res.data.current_weather))
      .catch(() => setWeather(null));
  }, []);

  return (
    <div className="widget weather-widget" style={{ position: 'relative'}}>
      <button className="remove-widget circular-remove" onClick={removeWidget} title="Remove">
        <CloseIcon fontSize="small" style={{ color: '#fff' }} />
      </button>
      <h3 className="weather-heading-centered">
        <i className="fa-solid fa-cloud-sun" style={{ marginRight: '8px', fontSize: '2rem', color: '#6593ff' }}></i>
        Weather Forecast
      </h3>
      {weather ? (
        <div className="weather-details-centered">
          <div>Calgary, Alberta</div>
          <div>{weather.temperature}Â°C</div>
          <div>Wind: {weather.windspeed} km/h</div>
        </div>
      ) : (
        <div>Loading...</div>
      )}
    </div>
  );
}
